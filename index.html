<!DOCTYPE html>
<html>
<head>
    <title>Arena Bot</title>
</head>
<body>
    <h1>Arena Bot</h1>
    <label for="token">Ð¢Ð¾ÐºÐµÐ½:</label>
    <input type="text" id="token" placeholder="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ‚Ð¾ÐºÐµÐ½"><br>
    <button onclick="startBot()">Ð¡Ñ‚Ð°Ñ€Ñ‚</button>

    <div id="output"></div>

    <script>
        function startBot() {
            const token = document.getElementById("token").value;
            let money = 0;
            let points = 0;
            let clan_points = 0;
            let mmr = 0;
            const payload = '{"type":"go on arena"}';
            const chat_id = "-220449804";

            function razdel(data) {
                const values = data.split(", ");
                money = parseInt(values[0].slice(0, -1)) + money;
                points = parseInt(values[1].slice(0, -1)) + points;
                mmr = parseInt(values[2].substring(1)) + mmr;
                clan_points = parseInt(values[3].slice(0, -2)) + clan_points;
            }

            function get_last_message() {
                const url = `https://api.vk.com/method/messages.getHistory?access_token=${token}&peer_id=${chat_id}&count=1&v=5.131`;
                fetch(url)
                    .then(response => response.json())
                    .then(response_json => {
                        if (response_json.error) {
                            console.error(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ð¸ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ: ${response_json.error.error_msg}`);
                        } else {
                            const message = response_json.response.items[0].text;
                            handle_message(message);
                        }
                    })
                    .catch(error => {
                        console.error(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ð¸ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ: ${error}`);
                    });
            }

            function send_callback_button() {
                const url = `https://api.vk.com/method/messages.send?access_token=${token}&peer_id=${chat_id}&message=Ð³Ð°Ð²Ð½ÑŽÐº&payload=${payload}&random_id=0&v=5.131`;
                fetch(url)
                    .then(response => response.json())
                    .then(response_json => {
                        if (response_json.error) {
                            console.error(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ¸: ${response_json.error.error_msg}`);
                        }
                    })
                    .catch(error => {
                        console.error(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ¸: ${error}`);
                    });
            }

            function handle_message(message) {
                if (message.indexOf('ðŸ¤¡Ñ‚Ñ‹ Ð¿Ñ€Ð¾Ð¸Ð³Ñ€Ð°Ð»') === 0) {
                    console.log('ÐŸÐ¸ÑÐµÑ† Ð¿Ñ€Ð¾Ð¸Ð³Ñ€Ñ‹Ñˆ((((');
                } else if(message.indexOf('ðŸ¤‘Ñ‚Ñ‹ Ð²Ñ‹Ð¹Ð³Ñ€Ð°Ð»') === 0) {
                    razdel(message.substring(12));
                    console.log(`Ð¢Ñ‹ Ð¿Ð¾Ð±ÐµÐ´Ð¸Ð»! ÐžÐ±Ñ‰Ð°Ñ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ Ð·Ð° Ð°Ð²Ñ‚Ð¾Ð°Ñ€ÐµÐ½Ñƒ ${money}ðŸª™ Ð¸ ${clan_points}ðŸŽ–ï¸ ÐºÐ»Ð°Ð½Ð¾Ð²Ñ‹Ñ… Ð¾Ñ‡ÐºÐ¾Ð²`);
                }
            }

            console.log('Ð”ÐµÐ´Ð¾Ðº Ð½Ð° Ð°Ñ€ÐµÐ½Ðµ!!!');
            setInterval(() => {
                send_callback_button();
                get_last_message();
            }, 1000);
        }
    </script>
</body>
</html>